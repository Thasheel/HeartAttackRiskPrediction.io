<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Attack Risk Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #111;
            background-image: url('https://images.unsplash.com/photo-1576091160550-2173dba999ef?auto=format&fit=crop&q=80');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            position: relative;
            color: #fff;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 4rem;
            background-color: rgba(0,0,0,0.5);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            text-decoration: none;
            color: #fff;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #0099cc;
        }

        .content-wrapper {
            max-width: 98%;
            margin: 0 auto;
            padding: 1rem 0;
        }

        .header-section, .metric-card, .recommendations-section, .chart-section, .risk-factors-section {
            background-color: rgba(0,0,0,0.7) !important;
            color: #fff !important;
        }

        .main-title, .recommendations-title, .success-title, .risk-factors-title, .sub-section-title {
            color: #00e6e6 !important;
        }

        .section-text, .metric-title, .metric-desc, .recommendation-list, .factor-text, .factor-list {
            color: #e0e0e0 !important;
        }

        .risk-badge {
            display: inline-block;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            margin: 0.5rem 0;
        }

        .risk-low {
            background-color: #d4edda;
            color: #28a745;
        }

        .risk-moderate {
            background-color: #fff3cd;
            color: #ffc107;
        }

        .risk-high {
            background-color: #f8d7da;
            color: #dc3545;
        }

        .risk-error {
            background-color: #e9ecef;
            color: #495057;
            border: 1px dashed #6c757d;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.8rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 1200px) {
            .metrics-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        .metric-card {
            background-color: rgba(0,0,0,0.7);
            padding: 0.8rem;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
            color: #fff;
        }

        .metric-icon {
            font-size: 1.4rem;
            margin-bottom: 0.4rem;
            color: #fff;
        }

        .metric-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #fff;
            margin-bottom: 0.3rem;
        }

        .metric-title {
            color: #fff;
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
        }

        .metric-desc {
            color: #fff;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: auto auto;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 992px) {
            .main-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }
        }

        .chart-section {
            background-color: white;
            padding: 0.7rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            height: 250px;
            grid-column: 2;
            grid-row: 1;
        }

        .recommendations-section {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            grid-column: 1;
            grid-row: 1 / span 2;
        }

        .risk-factors-section {
            background-color: white;
            padding: 0.8rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #dc3545;
            grid-column: 2;
            grid-row: 2;
            font-size: 0.9rem;
        }

        @media (max-width: 992px) {
            .chart-section {
                grid-column: 1;
                grid-row: 2;
            }
            
            .recommendations-section {
                grid-column: 1;
                grid-row: 1;
            }
            
            .risk-factors-section {
                grid-column: 1;
                grid-row: 3;
            }
        }

        .chart-title {
            text-align: center;
            color: #fff !important;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .recommendations-title {
            color: #007bff;
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
        }

        .alert-box {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 0.8rem;
            margin-bottom: 1rem;
        }

        .alert-title {
            color: #dc3545;
            font-size: 1rem;
            margin-bottom: 0.3rem;
        }

        .alert-text {
            color: #721c24;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .sub-section-title {
            color: #007bff;
            font-size: 1rem;
            margin-top: 0.8rem;
            margin-bottom: 0.4rem;
        }

        .recommendation-list {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 0.8rem;
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .important-note {
            font-weight: 500;
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 0.8rem;
        }

        .factor-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }

        .factor-item {
            border-left: 2px solid #dc3545;
            padding-left: 0.5rem;
            margin-bottom: 0.3rem;
        }

        .factor-title {
            color: #dc3545;
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
            font-weight: 500;
        }

        .factor-text {
            color: #666;
            font-size: 0.8rem;
            line-height: 1.3;
            margin: 0;
        }

        .factor-list {
            color: #666;
            font-size: 0.8rem;
            line-height: 1.3;
            margin: 0;
            padding-left: 1rem;
        }

        .header-section {
            text-align: center;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="{{ url_for('index') }}" class="logo">Heart Attack Prediction</a>
        <div class="nav-links">
            <a href="{{ url_for('index') }}">Home</a>
            <a href="{{ url_for('upload_file') }}">Upload</a>
            <!-- <a href="{{ url_for('predict') }}">Prediction</a> -->
        </div>
    </nav>

    <div class="content-wrapper">
        {% if external_url %}
        <div class="alert-box" style="margin-bottom: 20px;">
            <h3 class="alert-title">External Image Analysis</h3>
            <p class="alert-text">
                You are analyzing an image from an external source. Please ensure you have the right to use this image and that it meets our requirements:
            </p>
            <ul style="color: #721c24; margin-top: 10px; padding-left: 20px;">
                <li>Image should be clear and well-lit</li>
                <li>Format should be JPG, PNG, or TIFF</li>
                <li>Image should be of appropriate medical quality</li>
                <li>Source should be reliable and verified</li>
            </ul>
            <p style="color: #721c24; margin-top: 10px;">
                <strong>Note:</strong> For best results, we recommend using images from medical databases or those taken by healthcare professionals.
            </p>
        </div>
        {% endif %}

        <div class="header-section">
            <h1 class="main-title">Heart Health Analysis</h1>
            <div class="risk-badge risk-{{ 'low' if risk == 'Low Risk' else ('moderate' if risk == 'Moderate Risk' else ('error' if risk == 'Processing Error' else 'high')) }}">
                {{ risk }}
            </div>
            {% if risk == "Processing Error" and error_message %}
            <div style="margin-top: 10px; padding: 8px; background-color: #f8d7da; border: 1px solid #dc3545; border-radius: 5px;">
                <p style="color: #721c24; font-size: 0.9rem;">{{ error_message }}</p>
            </div>
            {% endif %}
        </div>

        <div class="metrics-grid">
            {% if risk != "Processing Error" %}
            <div class="metric-card">
                <div class="metric-icon">üë§</div>
                <h3 class="metric-title">Age</h3>
                <p class="metric-value">{{ age }}</p>
                <p class="metric-desc">Non-modifiable risk factor for cardiovascular disease.</p>
            </div>
            <div class="metric-card">
                <div class="metric-icon">üìà</div>
                <h3 class="metric-title">Systolic BP</h3>
                <p class="metric-value">{{ sbp }}</p>
                <p class="metric-desc">Maximum arterial pressure during heart contraction.</p>
            </div>
            <div class="metric-card">
                <div class="metric-icon">üìâ</div>
                <h3 class="metric-title">Diastolic BP</h3>
                <p class="metric-value">{{ dbp }}</p>
                <p class="metric-desc">Minimum arterial pressure between heartbeats.</p>
            </div>
            <div class="metric-card">
                <div class="metric-icon">‚öñÔ∏è</div>
                <h3 class="metric-title">BMI</h3>
                <p class="metric-value">{{ bmi }}</p>
                <p class="metric-desc">Weight-to-height ratio indicating body composition.</p>
            </div>
            <div class="metric-card">
                <div class="metric-icon">üî¨</div>
                <h3 class="metric-title">HbA1c</h3>
                <p class="metric-value">{{ hba1c }}</p>
                <p class="metric-desc">3-month average blood glucose indicator.</p>
            </div>
            <div class="metric-card">
                <div class="metric-icon">‚ù§Ô∏è</div>
                <h3 class="metric-title">Risk</h3>
                <p class="metric-value">{{ risk }}</p>
                <p class="metric-desc">Overall cardiovascular risk assessment.</p>
            </div>
            {% else %}
            <div class="metric-card" style="grid-column: 1 / -1;">
                <div class="metric-icon">üîß</div>
                <h3 class="metric-title">Troubleshooting</h3>
                <p class="metric-value">Error Detected</p>
                <p class="metric-desc">The system couldn't properly analyze your retinal image.</p>
            </div>
            {% endif %}
        </div>

        <div class="main-grid">
            <div class="recommendations-section">
                {% if risk == "Processing Error" %}
                <h2 class="recommendations-title">Unable to Complete Analysis</h2>
                
                <p class="section-text">
                    We encountered a technical issue while processing your data. Here are some possible solutions:
                </p>
                
                <h3 class="sub-section-title">Troubleshooting Steps:</h3>
                <ul class="recommendation-list">
                    <li>Make sure you've uploaded a clear image of the retina</li>
                    <li>The image should be in JPG, PNG, or TIFF format</li>
                    <li>Ensure the image is not corrupted</li>
                    <li>Try uploading a different image if available</li>
                    <li>Contact support if the problem persists</li>
                </ul>
                
                <p class="important-note">
                    If you continue to experience issues, please contact technical support.
                </p>
                {% elif risk == 'High Risk' %}
                <h2 class="recommendations-title">Urgent Heart Health Recommendations</h2>
                
                <p class="section-text">
                    Your analysis indicates significant cardiovascular risk factors that require immediate attention. Please follow these specific recommendations and consult with your cardiologist as soon as possible.
                </p>

                <div class="alert-box">
                    <h3 class="alert-title">Important - High Risk Alert</h3>
                    <p class="alert-text">
                        Your results indicate several concerning factors for heart disease. We strongly recommend seeking immediate medical attention 
                        from a cardiologist. Bring these results to your healthcare provider for a complete evaluation.
                    </p>
                </div>

                <h3 class="sub-section-title">Diet Recommendations:</h3>
                <ul class="recommendation-list">
                    <li>Strictly follow a heart-healthy diet:
                        <ul>
                            <li>Limit sodium to 1,500mg per day</li>
                            <li>Choose lean proteins (fish, poultry, legumes)</li>
                            <li>Increase fiber-rich foods (whole grains, vegetables)</li>
                        </ul>
                    </li>
                    <li>Completely avoid:
                        <ul>
                            <li>Processed and fried foods</li>
                            <li>Red meat and full-fat dairy</li>
                            <li>Added sugars and refined carbohydrates</li>
                            <li>Excessive alcohol and caffeine</li>
                        </ul>
                    </li>
                    <li>Monitor blood pressure and blood sugar daily</li>
                    <li>Stay well-hydrated (8-10 glasses of water daily)</li>
                </ul>

                <h3 class="sub-section-title">Exercise Recommendations:</h3>
                <ul class="recommendation-list">
                    <li>Strictly avoid:
                        <ul>
                            <li>High-intensity exercises</li>
                            <li>Heavy lifting</li>
                            <li>Activities that cause chest pain or shortness of breath</li>
                        </ul>
                    </li>
                    <li>Safe activities (with doctor's approval):
                        <ul>
                            <li>Gentle walking (10-15 minutes daily)</li>
                            <li>Light stretching</li>
                            <li>Supervised cardiac rehabilitation</li>
                        </ul>
                    </li>
                    <li>Always carry emergency medication if prescribed</li>
                    <li>Schedule immediate follow-up with cardiologist</li>
                </ul>

                {% elif risk == 'Moderate Risk' %}
                <h2 class="recommendations-title">Heart Health Recommendations</h2>
                
                <p class="section-text">
                    Your analysis shows some cardiovascular risk factors that require attention. Following these recommendations can help maintain and improve your heart health.
                </p>

                <h3 class="sub-section-title">Diet Recommendations:</h3>
                <ul class="recommendation-list">
                    <li>Daily heart-healthy foods:
                        <ul>
                            <li>5-7 servings of fruits and vegetables</li>
                            <li>Whole grains and high-fiber foods</li>
                            <li>Lean proteins (2-3 servings daily)</li>
                        </ul>
                    </li>
                    <li>Consider supplements (with doctor's approval):
                        <ul>
                            <li>Omega-3 fatty acids</li>
                            <li>CoQ10</li>
                            <li>Magnesium</li>
                        </ul>
                    </li>
                    <li>Limit processed foods and sugary snacks</li>
                    <li>Maintain regular meal times</li>
                </ul>

                <h3 class="sub-section-title">Exercise Recommendations:</h3>
                <ul class="recommendation-list">
                    <li>Regular cardiovascular routine:
                        <ul>
                            <li>30 minutes of moderate exercise daily</li>
                            <li>Start with walking, gradually increase intensity</li>
                            <li>Include strength training 2-3 times weekly</li>
                        </ul>
                    </li>
                    <li>Safe physical activities:
                        <ul>
                            <li>Brisk walking</li>
                            <li>Swimming</li>
                            <li>Cycling</li>
                            <li>Light yoga</li>
                        </ul>
                    </li>
                    <li>Monitor heart rate during exercise</li>
                    <li>Schedule regular check-ups with your doctor</li>
                </ul>

                {% elif risk == 'Low Risk' %}
                <h2 class="success-title">Maintain Your Good Heart Health</h2>
                
                <p class="section-text">
                    Congratulations! Your analysis shows good heart health. Continue with these preventive measures to maintain your cardiovascular wellness.
                </p>

                <h3 class="sub-section-title">Diet Recommendations:</h3>
                <ul class="recommendation-list">
                    <li>Maintain a balanced diet:
                        <ul>
                            <li>Mediterranean-style eating pattern</li>
                            <li>Regular servings of heart-healthy foods</li>
                            <li>Variety of colorful vegetables and fruits</li>
                        </ul>
                    </li>
                    <li>Stay hydrated</li>
                    <li>Limit processed foods and added sugars</li>
                    <li>Enjoy a variety of heart-healthy foods</li>
                </ul>

                <h3 class="sub-section-title">Exercise Recommendations:</h3>
                <ul class="recommendation-list">
                    <li>Maintain active lifestyle:
                        <ul>
                            <li>150 minutes of moderate exercise weekly</li>
                            <li>Mix of cardio and strength training</li>
                            <li>Regular physical activity throughout day</li>
                        </ul>
                    </li>
                    <li>Enjoy various activities:
                        <ul>
                            <li>Any exercise you enjoy</li>
                            <li>Outdoor activities</li>
                            <li>Sports and recreational activities</li>
                        </ul>
                    </li>
                    <li>Continue annual heart health check-ups</li>
                </ul>
                {% endif %}

                <p class="important-note">
                    Important: Always consult with your cardiologist or healthcare provider before making significant changes to your diet or exercise routine, especially if you have existing heart conditions.
                </p>
            </div>

            <div class="chart-section">
                <h2 class="chart-title" style="text-align: center; color: #fff;">Health Metrics Comparison</h2>
                {% if risk != "Processing Error" %}
                <canvas id="healthMetricsChart" 
                    data-sbp="{{ sbp }}"
                    data-dbp="{{ dbp }}"
                    data-bmi="{{ bmi }}"
                    data-hba1c="{{ hba1c }}" style="height: 250px;"></canvas>
                {% else %}
                <div style="height: 250px; display: flex; justify-content: center; align-items: center; flex-direction: column; color: #fff; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">üìä</div>
                    <p style="color: #fff; text-align: center;">Chart data unavailable due to processing error</p>
                </div>
                {% endif %}
            </div>
            
            {% if risk == 'High Risk' %}
            <div class="risk-factors-section">
                <h2 class="risk-factors-title">Risk Factors</h2>
                
                <div class="factor-grid">
                    {% if sbp > 130 %}
                    <div class="factor-item">
                        <h3 class="factor-title">Elevated BP</h3>
                        <p class="factor-text">
                            Systolic BP of {{ sbp }} / Diastolic BP of {{ dbp }} is higher than recommended range.
                        </p>
                    </div>
                    {% endif %}
                    
                    {% if bmi > 25 %}
                    <div class="factor-item">
                        <h3 class="factor-title">Elevated BMI</h3>
                        <p class="factor-text">
                            BMI of {{ bmi }} indicates {% if bmi > 30 %}obesity{% else %}overweight{% endif %}.
                        </p>
                    </div>
                    {% endif %}
                    
                    {% if hba1c > 5.7 %}
                    <div class="factor-item">
                        <h3 class="factor-title">Elevated HbA1c</h3>
                        <p class="factor-text">
                            HbA1c of {{ hba1c }} is {% if hba1c > 6.5 %}in diabetic range{% else %}elevated{% endif %}.
                        </p>
                    </div>
                    {% endif %}
                    
                    {% if age > 60 %}
                    <div class="factor-item">
                        <h3 class="factor-title">Age Risk</h3>
                        <p class="factor-text">
                            Age {{ age }} increases heart disease risk.
                        </p>
                    </div>
                    {% endif %}
                    
                    {% if high_risk_factors %}
                    <div class="factor-item">
                        <h3 class="factor-title">Retinal Abnormalities</h3>
                        <ul class="factor-list">
                            {% for factor in high_risk_factors %}
                            <li>{{ factor }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Add the download button -->
        <button id="download-pdf" style="display: block; margin: 20px auto; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
            Download PDF
        </button>

        <script>
            // Store the analysis results when the page loads
            document.addEventListener('DOMContentLoaded', function() {
                const imageHash = sessionStorage.getItem('currentImageHash');
                if (imageHash) {
                    const resultData = {
                        riskLevel: "{{ risk }}",
                        recommendations: `{% if risk == 'High Risk' %}
                            Your results indicate several concerning factors for heart disease. We strongly recommend seeking immediate medical attention from a cardiologist. Bring these results to your healthcare provider for a complete evaluation.
                        {% elif risk == 'Moderate Risk' %}
                            Your results suggest some risk factors that should be addressed. Consider consulting with a healthcare provider for a comprehensive evaluation.
                        {% else %}
                            Congratulations! Your analysis shows good heart health. Continue with preventive measures to maintain your cardiovascular wellness.
                        {% endif %}`,
                        timestamp: new Date().toISOString(),
                        metrics: {
                            age: "{{ age }}",
                            sbp: "{{ sbp }}",
                            dbp: "{{ dbp }}",
                            bmi: "{{ bmi }}",
                            hba1c: "{{ hba1c }}"
                        }
                    };
                    localStorage.setItem(`result_${imageHash}`, JSON.stringify(resultData));
                    // Clear the session storage after storing the result
                    sessionStorage.removeItem('currentImageHash');
                }
            });
        </script>

        <!-- Modal Form -->
        <div id="infoModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
            <div style="position: relative; background-color: #fff; margin: 10% auto; padding: 20px; width: 50%; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h2 style="color: #333; margin-bottom: 20px;">Additional Information</h2>
                <form id="additionalInfoForm">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #333;">Doctor's Name:</label>
                        <select id="doctorName" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">Select Doctor</option>
                            <option value="Dr. Sarah Johnson">Dr. Sarah Johnson</option>
                            <option value="Dr. Michael Chen">Dr. Michael Chen</option>
                            <option value="Dr. Emily Rodriguez">Dr. Emily Rodriguez</option>
                            <option value="Dr. James Wilson">Dr. James Wilson</option>
                            <option value="Dr. Lisa Patel">Dr. Lisa Patel</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #333;">Specialization:</label>
                        <input type="text" id="specialization" value="Retina Specialist" readonly style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; background-color: #f5f5f5;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #333;">Patient Name:</label>
                        <input type="text" id="patientName" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #333;">Patient Phone:</label>
                        <input type="tel" id="patientPhone" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div style="text-align: right;">
                        <button type="button" onclick="closeModal()" style="padding: 8px 15px; margin-right: 10px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
                        <button type="button" onclick="generatePDF()" style="padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Generate PDF</button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            // Health Metrics Chart
            const healthChart = document.getElementById('healthMetricsChart');
            
            // Only initialize chart if the element exists (not in error state)
            if (healthChart) {
                const healthCtx = healthChart.getContext('2d');
                
                // Get data from HTML data attributes
                const sbpValue = parseFloat(healthChart.dataset.sbp);
                const dbpValue = parseFloat(healthChart.dataset.dbp);
                const bmiValue = parseFloat(healthChart.dataset.bmi);
                const hba1cValue = parseFloat(healthChart.dataset.hba1c);
                
                new Chart(healthCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Systolic BP', 'Diastolic BP', 'BMI', 'HbA1c'],
                        datasets: [{
                            label: 'Your Values',
                            data: [sbpValue, dbpValue, bmiValue, hba1cValue],
                            backgroundColor: '#007bff',
                            borderColor: '#007bff',
                            borderWidth: 1
                        }, {
                            label: 'Normal Range',
                            data: [120, 80, 25, 5.7],
                            backgroundColor: '#28a745',
                            borderColor: '#28a745',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    font: {
                                        size: 10
                                    },
                                    color: '#fff'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        size: 10
                                    },
                                    color: '#fff'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    font: {
                                        size: 11
                                    },
                                    boxWidth: 15,
                                    color: '#fff'
                                }
                            },
                            title: {
                                display: false
                            }
                        },
                        layout: {
                            padding: {
                                left: 5,
                                right: 5,
                                top: 5,
                                bottom: 5
                            }
                        }
                    }
                });
            }

            // Function to show modal
            function showModal() {
                document.getElementById('infoModal').style.display = 'block';
            }

            // Function to close modal
            function closeModal() {
                document.getElementById('infoModal').style.display = 'none';
            }

            // Add click event to download button
            document.getElementById('download-pdf').addEventListener('click', showModal);

            // Function to generate PDF
            function generatePDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Get form values
                const doctorName = document.getElementById('doctorName').value || 'N/A';
                const specialization = document.getElementById('specialization').value || 'N/A';
                const patientName = document.getElementById('patientName').value || 'N/A';
                const patientPhone = document.getElementById('patientPhone').value || 'N/A';

                // Hospital Header
                doc.setFontSize(18);
                doc.setTextColor(0, 153, 102);
                doc.text("Evergreen Wellness Hospital", 105, 15, { align: "center" });
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text("123 Harmony Street Sunnyville, CA 90210 USA", 105, 21, { align: "center" });

                // Title
                doc.setFontSize(16);
                doc.setTextColor(0, 0, 0);
                doc.text("MEDICAL REPORT", 105, 32, { align: "center" });

                // Visit Info
                doc.setFontSize(12);
                doc.setTextColor(0, 153, 102);
                doc.text("Visit Info", 15, 42);
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text("Doctor's Name:", 15, 48);
                doc.text(doctorName, 50, 48);
                doc.text("Visit Date:", 120, 48);
                doc.text(new Date().toLocaleDateString(), 150, 48);
                doc.text("Specialization:", 15, 54);
                doc.text(specialization, 50, 54);

                // Patient Info
                doc.setFontSize(12);
                doc.setTextColor(0, 153, 102);
                doc.text("Patient Info", 15, 64);
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text("Full Name:", 15, 70);
                doc.text(patientName, 50, 70);
                doc.text("Phone:", 120, 70);
                doc.text(patientPhone, 150, 70);

                // Assessment
                doc.setFontSize(12);
                doc.setTextColor(0, 153, 102);
                doc.text("Assessment", 15, 82);
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text("Risk: {{ risk }}", 15, 88);
                doc.text("Age: {{ age }}", 15, 94);
                doc.text("Systolic BP: {{ sbp }}", 15, 100);
                doc.text("Diastolic BP: {{ dbp }}", 15, 106);
                doc.text("BMI: {{ bmi }}", 15, 112);
                doc.text("HbA1c: {{ hba1c }}", 15, 118);

                // Dynamic y-positioning
                let y = 130;

                // Diet Recommendations
                doc.setFontSize(12);
                doc.setTextColor(0, 153, 102);
                doc.text("Diet Recommendations", 15, y);
                y += 6;
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                let dietRecommendations = "";
                if ("{{ risk }}" === "High Risk") {
                    dietRecommendations = "‚Ä¢ Strictly follow a heart-healthy diet:\n  - Limit sodium to 1,500mg per day\n  - Choose lean proteins (fish, poultry, legumes)\n  - Increase fiber-rich foods (whole grains, vegetables)\n‚Ä¢ Completely avoid:\n  - Processed and fried foods\n  - Red meat and full-fat dairy\n  - Added sugars and refined carbohydrates\n  - Excessive alcohol and caffeine\n‚Ä¢ Monitor blood pressure and blood sugar daily\n‚Ä¢ Stay well-hydrated (8-10 glasses of water daily)";
                } else if ("{{ risk }}" === "Moderate Risk") {
                    dietRecommendations = "‚Ä¢ Daily heart-healthy foods:\n  - 5-7 servings of fruits and vegetables\n  - Whole grains and high-fiber foods\n  - Lean proteins (2-3 servings daily)\n‚Ä¢ Consider supplements (with doctor's approval):\n  - Omega-3 fatty acids\n  - CoQ10\n  - Magnesium\n‚Ä¢ Limit processed foods and sugary snacks\n‚Ä¢ Maintain regular meal times";
                } else {
                    dietRecommendations = "‚Ä¢ Maintain a balanced diet:\n  - Mediterranean-style eating pattern\n  - Regular servings of heart-healthy foods\n  - Variety of colorful vegetables and fruits\n‚Ä¢ Stay hydrated\n‚Ä¢ Limit processed foods and added sugars\n‚Ä¢ Enjoy a variety of heart-healthy foods";
                }
                const dietLines = doc.splitTextToSize(dietRecommendations, 180);
                doc.text(dietLines, 15, y);
                y += dietLines.length * 6 + 2;

                // Exercise Recommendations
                doc.setFontSize(12);
                doc.setTextColor(0, 153, 102);
                doc.text("Exercise Recommendations", 15, y);
                y += 6;
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                let exerciseRecommendations = "";
                if ("{{ risk }}" === "High Risk") {
                    exerciseRecommendations = "‚Ä¢ Strictly avoid:\n  - High-intensity exercises\n  - Heavy lifting\n  - Activities that cause chest pain or shortness of breath\n‚Ä¢ Safe activities (with doctor's approval):\n  - Gentle walking (10-15 minutes daily)\n  - Light stretching\n  - Supervised cardiac rehabilitation\n‚Ä¢ Always carry emergency medication if prescribed\n‚Ä¢ Schedule immediate follow-up with cardiologist";
                } else if ("{{ risk }}" === "Moderate Risk") {
                    exerciseRecommendations = "‚Ä¢ Regular cardiovascular routine:\n  - 30 minutes of moderate exercise daily\n  - Start with walking, gradually increase intensity\n  - Include strength training 2-3 times weekly\n‚Ä¢ Safe physical activities:\n  - Brisk walking\n  - Swimming\n  - Cycling\n  - Light yoga\n‚Ä¢ Monitor heart rate during exercise\n‚Ä¢ Schedule regular check-ups with your doctor";
                } else {
                    exerciseRecommendations = "‚Ä¢ Maintain active lifestyle:\n  - 150 minutes of moderate exercise weekly\n  - Mix of cardio and strength training\n  - Regular physical activity throughout day\n‚Ä¢ Enjoy various activities:\n  - Any exercise you enjoy\n  - Outdoor activities\n  - Sports and recreational activities\n‚Ä¢ Continue annual heart health check-ups";
                }
                const exerciseLines = doc.splitTextToSize(exerciseRecommendations, 180);
                doc.text(exerciseLines, 15, y);
                y += exerciseLines.length * 6 + 2;

                // Ensure enough space before footer
                if (y > 260) {
                    y = 270;
                } else {
                    y = 260;
                }

                // Footer
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text("For inquiries and appointments, feel free to contact us.", 105, 280, { align: "center" });
                doc.text("phone: +1 (555) 123-4567, email: info@EvergreenWellnessHospital.com", 105, 285, { align: "center" });
                doc.text("www.EvergreenWellnessHospital.com", 105, 290, { align: "center" });

                // Save the PDF
                doc.save("medical_report.pdf");
                
                // Close the modal
                closeModal();
            }
        </script>
    </div>
</body>
</html>
